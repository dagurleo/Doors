@model DoorsSocialWeb.Models.ViewModels.GroupViewModel

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
</head>
<body>
    <div>
        @if (Model.currentGroup.groupName != null && Model.currentGroup.groupName != "")
        {
            <h1>@Model.currentGroup.groupName</h1>
        }
        @if (Model.currentGroup.groupDescription != null && Model.currentGroup.groupName != "")
        {
            <h1>@Model.currentGroup.groupDescription</h1>
        }
    </div>


    <div>
        @if ((!(Model.userIsMember(Model.currentUser.Id)) && Model.currentUser.Id != Model.currentGroup.groupOwnerID) && Model.userIsPendingMember(Model.currentUser.Id) == false)
        {
                using (Html.BeginForm("requestToJoinGroup", "LoggedIn", FormMethod.Post))
                {
                    <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                    <input type="hidden" name="groupid" value="@Model.currentGroup.ID" />
                    <input type="hidden" name="groupOwner" value="@Model.currentGroup.groupOwnerID" />
                    <input type="submit" value="Click me to request to join this group" />
                }
        }
        @if(Model.currentGroup.groupOwnerID == Model.currentUser.Id)
        {
            <!--ACCEPT USERS-->
            <!-- Búa til fall sem sækir öll request's-->
            <!-- og birtir þau hér, með html form sem hann getur samþykkt og þá vistast sá notandi í gagnagrunnin-->
            if (Model.pendingRequests(Model.currentGroup.ID) != null)
            {
                <!--Foreach skilar mér requestuserIds sem ég get acceptað sem ég converta í userdisplayname-->
                foreach(var m in Model.pendingRequests(Model.currentGroup.ID))
                {
                    if (@m.userIsApproved == false)
                    {
                        using (Html.BeginForm("ownerOfGroupAcceptsUsers", "LoggedIn", FormMethod.Post))
                        {
                            <input type="hidden" name="userid" value="@m.userRequestId"/>
                            <input type="hidden" name="groupid" value="@Model.currentGroup.ID"/>
                            <input type="hidden" name="groupOwner" value="@Model.currentGroup.groupOwnerID" />
                            <p>@Model.getUserByID(m.userRequestId).displayName</p>
                            <input type="submit" value="Accept this user"/>
                        }
                    }
                }
            }
            
            using(Html.BeginForm("ownerOfGroupCreateNewTopic", "LoggedIn", FormMethod.Post))
            {
                <input type="hidden" name="groupid" value="@Model.currentGroup.ID" />
                <input type="hidden" name="ownerid" value="@Model.currentGroup.groupOwnerID" />
                <p>Topic name: </p>
                <input type="text" name="topicName" value="Topic name" />
                <input type="submit" value="addtopic" />
            }
        }
    </div>

    <div>
        @if ((Model.userIsApprovedMember(Model.currentUser.Id, Model.currentGroup.ID)))
        {
            using(Html.BeginForm("approvedUsersAddNewPostInGroup", "LoggedIn", FormMethod.Post))
            {
                <input type="hidden" name="groupid" value="@Model.currentGroup.ID" />
                <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                <select name="topicid">
                    @foreach (var t in Model.getTopicsWithinGroup(Model.currentGroup.ID))
                    {
                        <option value="@t.ID">@t.topicName</option>
                    }
                </select>
                <div class="createPost">
                    <textarea name="subject" placeholder="Share your thoughts with your group buddies!"></textarea>
                <input type="submit" value="POST" />
                </div>
            }
            if(Model.getPostsWithinGroup(Model.currentGroup.ID) != null)
            {
                foreach(var m in Model.getPostsWithinGroup(Model.currentGroup.ID))
                {
                    <p>@Model.getUserByID(m.authorID).displayName</p>
                    <p>@m.subject</p>
                }
            }
            else
            {
                <p>NoPostsToShow</p>
            }
        }
        else
        {
            <p>Not approved memeber, no posts to show.</p>
        }
    </div>

</body>
</html>
