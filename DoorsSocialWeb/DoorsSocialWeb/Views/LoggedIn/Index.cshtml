@model DoorsSocialWeb.Models.ViewModels.IndexViewModel
@{

}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>

</head>
<body>

    @using (Html.BeginForm("Post", "LoggedIn", FormMethod.Post))
    {
        <input type="hidden" name="userid" value="@Model.currentUser.Id" />
        <input type="hidden" name="datetime" value="@Model.datetime" />
        <div class="createPost">
            <textarea name="subject" placeholder="Share your thoughts with your friends!"></textarea>
            <input type="submit" value="POST" />
        </div>
    }

    @if (Model.posts != null)
    {
        if (Model.posts.Count() == 0)
        {
            <p>No Posts to show</p>
        }
        foreach (var m in Model.posts)
        {
            <div class="postContainer">
                <div class="postDate">
                    <p style="font-weight: bold">@m.dateCreated</p>
                </div>
                <div class="postImage">
                    <a href="@Url.Action("Profile", "LoggedIn", new { id = m.authorID })">
                        <img src="@Model.getAuthor(m.authorID).displayImageUrl" alt="Profile pic" />
                    </a>
                </div>
                <h1>@Model.getAuthor(m.authorID).displayName</h1>
                <div class="postText">
                    <p>@m.subject</p>
                </div>
                <div class="postLikes">
                    <p id="likeCount">@Model.getUsersWhoLikesPost(m.ID).Count()</p>
                </div>
                <div class="likebutton">
                    @if (Model.hasCurrentUserLikedPost(m.ID) == false)
                    {

                        using (Html.BeginForm("addLikeToPost", "LoggedIn", FormMethod.Post, new { id = "likeForm" }))
                        {
                            <input type="hidden" name="userid" value="@Model.currentUser.Id" id="userId" />
                            <input type="hidden" name="postid" value="@m.ID" id="postId" />
                            <input type="submit" value="Like" />
                        }
                    }
                    else
                    {
                        using (Html.BeginForm("RemoveLikeFromPost", "LoggedIn", FormMethod.Post))
                        {
                            <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                            <input type="hidden" name="postid" value="@m.ID" />
                            <input type="submit" value="Unlike" />
                        }
                    }
                </div>

                <div class="postComments">
                    @if (Model.getCommentsForPost(m.ID).Count() == 0)
                    {
                        <p>HEYNOCOMMENTSYOUCUNT</p>
                    }
                    else
                    {
                        foreach (var c in Model.getCommentsForPost(m.ID))
                        {
                            <div class="commentContainer">
                                <div class="commentDate">
                                    <p style="font-weight: bold">@m.dateCreated</p>
                                </div>
                                <div class="commentImage">
                                    <a href="@Url.Action("Profile", "LoggedIn", new { id = c.authorID })">
                                        <img src="@Model.getAuthor(c.authorID).displayImageUrl" alt="Profile pic" />
                                    </a>
                                </div>
                                <h2>@Model.getAuthor(c.authorID).displayName</h2>
                                <div class="postText">
                                    <p>@c.subject</p>
                                </div>
                            </div>
                        }
                    }
                </div>
                @using (Html.BeginForm("addCommentToPost", "LoggedIn", FormMethod.Post))
                {

                    <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                    <input type="hidden" name="postid" value="@m.ID" />
                    <div class="commentOnPost">
                        <textarea name="subject" placeholder="Share your comment with your friends!"></textarea>
                        <input type="submit" value="POST" />
                    </div>
                }



            </div>
        }
    }
</body>
</html>
