@model DoorsSocialWeb.Models.ViewModels.IndexViewModel
@{

}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>

</head>
<body>

    @using (Html.BeginForm("Post", "LoggedIn", FormMethod.Post))
    {
        <input type="hidden" name="userid" value="@Model.currentUser.Id" />
        <input type="hidden" name="datetime" value="@Model.datetime" />
        <div class="createPost">
            <textarea name="subject" placeholder="Share your thoughts with your friends!"></textarea>
            <input type="submit" value="POST" />
        </div>
    }

    @if (Model.posts != null)
    {
        if (Model.posts.Count() == 0)
        {
            <p>No Posts to show</p>
        }
        foreach (var m in Model.posts)
        {
            <div class="postContainer">
                <div class="postDate">
                    <p style="font-weight: bold">@m.dateCreated</p>
                </div>
                <a href="@Url.Action("Profile", "LoggedIn", new { id = m.authorID })">
                    <div class="postImage">

                        <img src="@Model.getAuthor(m.authorID).displayImageUrl" alt="Profile pic" />
                    </div>

                    <h1>@Model.getAuthor(m.authorID).displayName</h1>
                </a>
                <div class="postText">
                    <p>@m.subject</p>
                </div>
                <div class="postLikes">
                    <p id="likeCount">@Model.getUsersWhoLikesPost(m.ID).Count()</p>
                </div>
                <div class="likebutton">
                    @if (Model.hasCurrentUserLikedPost(m.ID) == false)
                    {

                        using (Html.BeginForm("addLikeToPost", "LoggedIn", FormMethod.Post, new { id = "likeForm" }))
                        {
                            <input type="hidden" name="userid" value="@Model.currentUser.Id" id="userId" />
                            <input type="hidden" name="postid" value="@m.ID" id="postId" />
                            <input type="image" src="http://icons.iconarchive.com/icons/custom-icon-design/mono-business-2/128/thumbs-up-icon.png" width="30px" height="30px" alt="submit">
                        }
                    }
                    else
                    {
                        using (Html.BeginForm("RemoveLikeFromPost", "LoggedIn", FormMethod.Post))
                        {
                            <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                            <input type="hidden" name="postid" value="@m.ID" />
                            <input type="image" src="http://icons.iconarchive.com/icons/custom-icon-design/mono-business-2/32/thumbs-down-icon.png" width="30px" height="30px" alt="submit">
                        }
                    }
                </div>
                @if(m.authorID == Model.currentUser.Id)
                {
                    <a href="@Url.Action("DeletePost", "LoggedIn", new {postId = m.ID})">Remove Post</a>
                }
                
                <div class="postComments">
                    @foreach (var c in Model.getCommentsForPost(m.ID))
                    {
                        <div class="commentContainer">
                            <div class="commentDate">
                                <p style="font-weight: bold">@c.dateCreated</p>
                            </div>
                            <a href="@Url.Action("Profile", "LoggedIn", new { id = c.authorID })">
                                <div class="commentImage">
                                        <img src="@Model.getAuthor(c.authorID).displayImageUrl" alt="Profile pic" />                                        
                                </div>
                                <h2>@Model.getAuthor(c.authorID).displayName</h2>
                            </a>
                            <div class="postText">
                                <p>@c.subject</p>
                            </div>
                            @if(c.authorID == Model.currentUser.Id)
                            {
                                <a href="@Url.Action("removeCommentFromPost", "LoggedIn", new { commentId = c.ID })">Remove Comment</a>   
                            }
                        </div>
                    }
                    
                </div>
                <div class="commentCreator">
                    @using (Html.BeginForm("addCommentToPost", "LoggedIn", FormMethod.Post))
                    {
                        <input type="hidden" name="userid" value="@Model.currentUser.Id" />
                        <input type="hidden" name="postid" value="@m.ID" />
                        <div class="createComment">
                            <textarea name="subject" placeholder="Share your thoughts with your friends!"></textarea>
                            <input type="submit" value="COMMENT" />
                        </div>
                    }
                </div>

              
            </div>
        }
    }
</body>
</html>
